<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>BazyGo â€“ History + Live + Studio (FINAL)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/flv.js/dist/flv.min.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma,Arial;background:#f3f4f6;color:#111827}
header{padding:6px 12px;background:#1e40af;color:#fff;font-size:14px;font-weight:bold}
.tabs{display:flex;background:#fff;border-bottom:1px solid #e5e7eb}
.tab{padding:10px 14px;cursor:pointer;font-size:13px;color:#6b7280}
.tab.active{color:#1d4ed8;font-weight:bold;border-bottom:3px solid #2563eb}
.container{padding:8px}
.card{background:#fff;border-radius:8px;padding:8px;border:1px solid #e5e7eb;margin-bottom:8px}
.controls-row{display:flex;gap:6px;flex-wrap:wrap}
.btn{border:none;border-radius:999px;padding:6px 10px;font-size:11px;cursor:pointer;background:#111827;color:#fff}
.btn.secondary{background:#e5e7eb;color:#111827}

/* Studio */
.studio-grid{display:grid;gap:8px;margin-top:8px}
.studio-grid.grid{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
.studio-grid.focus{grid-template-columns:2fr 1fr;grid-template-rows:repeat(3,1fr)}
.studio-tile{position:relative;background:#000;border-radius:8px;overflow:hidden}
.studio-tile video{width:100%;height:100%;object-fit:cover}
.studio-close{position:absolute;top:6px;left:6px;width:28px;height:28px;border-radius:50%;border:none;background:rgba(0,0,0,.6);color:#fff;font-size:16px;cursor:pointer}

@media(max-width:1024px){
.studio-grid.grid{grid-template-columns:repeat(2,1fr)}
.studio-grid.focus{grid-template-columns:1fr;grid-template-rows:auto}
}
</style>
</head>

<body>

<header>ğŸ¥ BazyGo â€“ History + Live + Studio (FINAL)</header>

<div class="tabs">
<span id="tabHistory" class="tab active" onclick="showTab('history')">ğŸ“ History</span>
<span id="tabLive" class="tab" onclick="showTab('live')">ğŸ“¡ Live</span>
<span id="tabStudio" class="tab" onclick="showTab('studio')">ğŸ¬ Studio</span>
</div>

<div class="container">

<!-- HISTORY -->
<div id="historyPanel" class="card">
<h3>History</h3>
<p>â¬… Ù‡Ù†Ø§ ÙŠØ¨Ù‚Ù‰ ÙƒÙˆØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª (Playback + Timeline) ÙƒÙ…Ø§ Ø£Ø±Ø³Ù„ØªÙ‡ Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØºÙŠÙŠØ±.</p>
</div>

<!-- LIVE -->
<div id="livePanel" class="card" style="display:none">
<h3>Live</h3>
<p>â¬… Ù‡Ù†Ø§ ÙŠØ¨Ù‚Ù‰ ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (livein / liveout) ÙƒÙ…Ø§ Ù‡Ùˆ.</p>
</div>

<!-- STUDIO -->
<div id="studioPanel" class="card" style="display:none">
<h3>Studio â€“ Multi Camera</h3>

<div class="controls-row">
<select id="studioDeviceSelect">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø§Ø²</option>
<option value="demo">Demo</option>
</select>

<select id="studioCamType">
<option value="livein">ğŸ“· Ø¯Ø§Ø®Ù„ÙŠØ©</option>
<option value="liveout">ğŸ“· Ø®Ø§Ø±Ø¬ÙŠØ©</option>
</select>

<button class="btn" onclick="addStudioCamera()">â• Ø¥Ø¶Ø§ÙØ©</button>
<button class="btn secondary" onclick="addAllStudioCameras()">â•â• Ø§Ù„ÙƒÙ„</button>
<button class="btn secondary" onclick="setStudioLayout('grid')">â¬› 2Ã—2</button>
<button class="btn secondary" onclick="setStudioLayout('focus')">ğŸ¯ 1+3</button>
</div>

<div id="studioGrid" class="studio-grid grid"></div>
</div>

</div>

<script>
const STREAM_HOST="streaming.bazytrack.jo";
const studioStreams={};
let currentLayout="grid";

function showTab(tab){
["history","live","studio"].forEach(t=>{
document.getElementById(t+"Panel").style.display = t===tab?"block":"none";
document.getElementById("tab"+t.charAt(0).toUpperCase()+t.slice(1)).classList.toggle("active",t===tab);
});
}

function setStudioLayout(l){
currentLayout=l;
const g=document.getElementById("studioGrid");
g.classList.remove("grid","focus");
g.classList.add(l);
saveStudioState();
}

function addStudioCamera(){
const d=studioDeviceSelect.value;
const t=studioCamType.value;
if(!d)return;
const k=d+"_"+t;
if(studioStreams[k])return;

const tile=document.createElement("div");
tile.className="studio-tile";
tile.id="tile_"+k;

const v=document.createElement("video");
v.autoplay=true;v.muted=true;v.playsInline=true;

const c=document.createElement("button");
c.className="studio-close";c.textContent="âœ•";
c.onclick=()=>removeStudioCamera(k);

tile.append(v,c);
studioGrid.appendChild(tile);

const url=`https://${STREAM_HOST}/live/0/${d}.flv`;
const p=flvjs.createPlayer({type:"flv",url,isLive:true,hasAudio:false});
p.attachMediaElement(v);p.load();p.play();

studioStreams[k]={p,v};
saveStudioState();
}

function addAllStudioCameras(){
["livein","liveout"].forEach(x=>{studioCamType.value=x;addStudioCamera();});
}

function removeStudioCamera(k){
const s=studioStreams[k];
if(!s)return;
try{s.p.destroy()}catch(e){}
delete studioStreams[k];
document.getElementById("tile_"+k)?.remove();
saveStudioState();
}

function saveStudioState(){
localStorage.setItem("studioState",JSON.stringify({
layout:currentLayout,
cameras:Object.keys(studioStreams)
}));
}

(function restore(){
const r=localStorage.getItem("studioState");
if(!r)return;
const s=JSON.parse(r);
if(s.layout)setStudioLayout(s.layout);
})();
</script>

</body>
</html>
