<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route from GraphHopper</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"></script>
    <style>
        #map { height: 600px; }
        #instructions { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Route from GraphHopper</h1>
    <div id="map"></div>
    <div id="instructions">
        <h3>Directions:</h3>
        <ul id="instruction-list"></ul>
    </div>

    <script>
        // Initialize the map
        var map = L.map('map').setView([48.118477, 11.539421], 13);

        // Add tile layer to the map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var points = []; // To store clicked points
        var markers = []; // To store marker objects

        // Function to send the API request to GraphHopper
        function getRoute() {
            if (points.length < 2) {
                alert("Please select at least two points on the map.");
                return;
            }

            // Send the POST request to GraphHopper API
            var requestBody = {
                points: points,
                snap_preventions: ["motorway", "ferry", "tunnel"],
                details: ["road_class", "surface"],
                profile: "car",
                locale: "en",
                instructions: true,
                calc_points: true,
                points_encoded: false
            };

            axios.post('https://graphhopper.com/api/1/route?key=e18fd573-f742-4069-8f82-5642fae3450e', requestBody)
                .then(function(response) {
                    // Extract the route from the response
                    var route = response.data.paths[0];
                    var coordinates = route.points.coordinates;

                    // Display the route on the map
                    var routeLine = L.polyline(coordinates.map(function(coord) {
                        return [coord[1], coord[0]]; // Convert from lng/lat to lat/lng
                    }), { color: 'blue' }).addTo(map);

                    // Zoom to the route bounds
                    map.fitBounds(routeLine.getBounds());

                    // Display the directions
                    displayInstructions(route.instructions);
                })
                .catch(function(error) {
                    console.error("Error fetching route:", error);
                });
        }

        // Function to display directions
        function displayInstructions(instructions) {
            var instructionList = document.getElementById('instruction-list');
            instructionList.innerHTML = ''; // Clear any existing instructions
            instructions.forEach(function(instruction) {
                var li = document.createElement('li');
                li.textContent = instruction.text;
                instructionList.appendChild(li);
            });
        }

        // Function to add points when clicking on the map
        function onMapClick(e) {
            if (points.length < 8) { // Limit the number of points to 4
                // Add the point to the array
                points.push([e.latlng.lat, e.latlng.lng]);

                // Add marker to the map
                var marker = L.marker(e.latlng).addTo(map);
                markers.push(marker);

                // If there are two or more points, enable route calculation
                if (points.length >= 2) {
                    getRoute();
                }
            } else {
                alert("You can only select up to 4 points.");
            }
        }

        // Add event listener for map click to add points
        map.on('click', onMapClick);

    </script>
</body>
</html>
