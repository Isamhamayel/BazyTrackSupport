<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>BazyTrack â€“ Playback</title>

<script src="https://cdn.jsdelivr.net/npm/flv.js/dist/flv.min.js"></script>

<style>
body {
    margin:0;
    font-family:Tahoma, Arial;
    background:#f2f2f2;
}

/* PAGE LAYOUT */
.container {
    display:flex;
    height:100vh;
}

/* LEFT SIDE â€“ FILES */
.left {
    width:40%;
    background:white;
    border-left:2px solid #ddd;
    overflow-y:auto;
    padding:12px;
}

.file {
    padding:10px;
    background:#fafafa;
    margin-bottom:8px;
    border:1px solid #ddd;
    border-radius:6px;
    cursor:pointer;
}
.file:hover {
    background:#e7f2ff;
}

/* RIGHT SIDE â€“ VIDEO */
.right {
    width:60%;
    background:#fff;
    padding:12px;
    position:relative;
    display:flex;
    flex-direction:column;
}

#videoPlayer {
    width:100%;
    height:70vh;
    background:black;
    border-radius:8px;
}

/* DOWNLOAD BUTTON */
#downloadLink {
    margin-top:10px;
    padding:10px 15px;
    background:#28a745;
    color:white;
    text-align:center;
    border-radius:6px;
    font-size:15px;
    display:none;
    text-decoration:none;
}

/* MOBILE MODE */
@media(max-width:900px){
    .container { flex-direction:column; }
    .left { width:100%; height:40vh; }
    .right { width:100%; height:60vh; }
    #videoPlayer { height:50vh; }
}
</style>
</head>

<body>

<div class="container">

    <!-- LEFT SIDE -->
    <div class="left">
        <h3>ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</h3>
        <div id="fileList">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®...</div>
    </div>

    <!-- RIGHT SIDE -->
    <div class="right">

        <h3>ğŸ¥ Ø§Ù„Ù…Ø´ØºÙ‘Ù„</h3>

        <video id="videoPlayer"
               controls
               playsinline
               webkit-playsinline
               onclick="manualPlay()">
        </video>

        <a id="downloadLink" target="_blank">â¬‡ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù FLV</a>

    </div>

</div>


<script>
/* CONFIG */
const STREAM_HOST = "streaming.bazytrack.jo";
let currentImei = null;

/* Fix iPhone WebView: user must TAP the video to start */
function manualPlay(){
    const v = document.getElementById("videoPlayer");
    v.play().catch(()=>{});
}

/* STOP any existing playback */
function stopPlayback(){
    const v = document.getElementById("videoPlayer");
    if (window.flvPlayer){
        window.flvPlayer.destroy();
        window.flvPlayer = null;
    }
    v.pause();
    v.removeAttribute("src");
    v.load();
}

/* PLAY VIDEO */
function playVideo(filename, imei){

    stopPlayback();
    currentImei = imei;

    const video = document.getElementById("videoPlayer");
    const download = document.getElementById("downloadLink");

    // ALWAYS make download link available
    const flvUrl = `https://${STREAM_HOST}/live/0/${imei}.flv`;
    download.href = flvUrl;
    download.style.display = "block";

    // Detect iPhone Safari / Traccar iOS WebView
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

    if (isIOS){
        // iOS MUST use HLS (m3u8)
        const url = `https://${STREAM_HOST}/live/0/${imei}.m3u8`;
        video.src = url;

        // user MUST tap to start playback
        return;
    }

    // Chrome / Android WebView â†’ FLV
    if (flvjs.isSupported()){
        const flvUrl = `https://${STREAM_HOST}/live/0/${imei}.flv`;
        window.flvPlayer = flvjs.createPlayer({ type:"flv", url: flvUrl });
        window.flvPlayer.attachMediaElement(video);
        window.flvPlayer.load();
        video.play().catch(()=>{});
    }
}

/* DEMO FILE LOADING â€” replace with your sheet logic */
document.getElementById("fileList").innerHTML = `
    <div class="file" onclick="playVideo('file1','864993060752780')">
        10:00 â€“ ÙƒØ§Ù…ÙŠØ±Ø§ 1
    </div>
    <div class="file" onclick="playVideo('file2','864993060752780')">
        11:00 â€“ ÙƒØ§Ù…ÙŠØ±Ø§ 2
    </div>
`;
</script>

</body>
</html>
